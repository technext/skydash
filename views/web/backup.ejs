<%- include ("userheader.ejs") %>

<!-- Page Header Start -->
<div class="container-fluid bg-dark bg-img p-5 mb-5">
    <div class="row">
        <div class="col-12 text-center">
            <h1 class="display-4 text-uppercase text-white">Shopping Cart</h1>
            <a href="/">Home</a>
            <i class="far fa-square text-primary px-2"></i>
            <a href="/about">About</a>
        </div>
    </div>
</div>
<!-- Page Header End -->

<head>
    <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">  
       <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">   

</head>

    <div class="container main-section">  
        <div class="row">  
            <div class="col-lg-12 pb-2">  
                <h2> Shoping Cart </h2>  
            </div>  
            <div class="col-lg-12 pl-3 pt-3">  
                <table class="table table-hover border bg-white">  
                    <thead>  
                        <tr>  
                            <th> <h4> <b>  Product Details </b> </h4> </th>  
                            <th> <h4> <b> Price </h4> <b> </th>  
                            <th style="width:10%;"> <h4> <b> Quantity <b> </h4> </th>  
                            <th> <h4> <b> Subtotal <b> </h4> </th>  
                            <th> <h4> <b> Action <b> </h4> </th>  
                        </tr>  
                    </thead>  
                    <tbody id="cartitems">  
                           
                        <% for(var i = 0; i < cDetails.length; i++) { %>
                        <tr>  
                            <td>  
                                <div class="row">  
                                    <div class="col-lg-2 Product-img">  
                                        <img src="../uploads/productsImages/<%- cDetails[i].pimgname %>" alt="..." class="img-responsive"/>  
                                    </div>  
                                    <div class="col-lg-10">  
                                        <h5 class="nomargin"> <b>  <%- cDetails[i].title %>  </b> </h5>  
                                        <p> <%- cDetails[i].description %>  </p>  
                                    </div>  
                                </div>  
                            </td>  
                            <td> <strong > <%- cDetails[i].price %> </strong> </td>  
                            
                            <td data-th="Quantity" class='addtocart1' >
                                <input type="hidden" id="pricecounter" value="<%- cDetails[i].price %>" >                             
                                <b> <input onchange="pricecounter('<%= cDetails[i]._id %>')"  type="number" id="qty"  class="form-control text-center" min="0" max="10" value="1"> </b>  
                            </td>  

                            
                            <td>    <strong class='<%= cDetails[i]._id %>'> </strong>    </td>  


                            <td class="actions" id="deleteItem" data-th="" style="width:10%;">
                                
                                <input type="hidden" id="cakeId" value= "<%- cDetails[i]._id %>" >  
                                <button onclick="removeFromCart('<%= cDetails[i]._id %>')" value= "<%- cDetails[i]._id %>"  class="btn btn-danger btn-sm"> <i class="fa fa-trash-o"> </i> </button>                               
                            </td>
                        </tr>  
                        <% } %>       
                    </tbody>  
                    <tfoot>  
                        <tr>  
                            <td> <a href="/menu" class="btn btn-success "> <i class="fa fa-angle-left"> </i> Continue Shopping </a> </td>  
                            <td colspan="2" class="hidden-xs"> </td>  
                            <td class="hidden-xs text-center" style="width:10%;"> <strong> Total Price :></strong> </td>  
                            <td> <a href="#" class="btn btn-success btn-block"> Checkout <i class="fa fa-angle-right"> </i> </a> </td>  
                        </tr>  
                    </tfoot>  
                </table>  
            </div>  
        </div>  
    </div>  

<script>

//============= Delete Cart Item ============== 
function removeFromCart(_id){
    // alert(id);
    $.ajax({
                url: "/user/deleteItem/"+_id,
                type: "POST",
                data:{ _id : _id },
                dataType: 'json',
                    success: function(result) {
                        console.log(result)
                       window.location.href="/user/shopcart"
                    }
                }
    )
}


function pricecounter(_id){  
          
            $.ajax({
                url: "/user/fetchPrice",
                type: "POST",
                data:{ _id : _id },
                dataType: 'json',
                    success: function(result) {                                
                        var cakeId = result.cake._id;                     
                        var priceCount = result.cake.price;                           
            $(".addtocart1").change(function () {
                var qty = $('#qty').val();  
                console.log(cakeId+"----"+_id)
                                       
                            $("."+_id).animate({opacity: 1}, 300, function vasu (cakeId) {            
                                        $(this).text(priceCount*qty);
                                    
                                    });
                        });  
        
                    }
                }
            )
           
        
        }
                               


</script>
    
<%- include ("footer.ejs") %>